---
layout: post
title:  第85期
---
# C++ 中文周刊 第85期


从[reddit](https://www.reddit.com/r/cpp/)/[hackernews](https://news.ycombinator.com/)/[lobsters](https://lobste.rs/)/[meetingcpp](https://www.meetingcpp.com/blog/blogroll/)/[purecpp](http://www.purecpp.cn/)知乎/等等摘抄一些c++动态

`TODO fix meetingcpp blogroll link`

[周刊项目地址](https://github.com/wanghenshui/cppweeklynews)｜[在线地址](https://wanghenshui.github.io/cppweeklynews/) ｜[知乎专栏](https://www.zhihu.com/column/jieyaren) |[腾讯云+社区](https://cloud.tencent.com/developer/column/92884) 

弄了个qq频道，[手机qq点击进入](https://qun.qq.com/qqweb/qunpro/share?_wv=3&_wwv=128&inviteCode=xzjHQ&from=246610&biz=ka)

欢迎投稿，推荐或自荐文章/软件/资源等

TODO: 公众号

可以贴在下一期草稿里 [草稿链接](https://github.com/wanghenshui/cppweeklynews/pull/17)

2022 1021  

---

## 资讯

标准委员会动态/ide/编译器信息放在这里

[十月标准委员会邮件汇总](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/#mailing2022-10)

[编译器信息最新动态推荐关注hellogcc公众号 本周更新 2022-01-05 第131期](https://github.com/hellogcc/osdt-weekly/blob/master/weekly-2022/2022-01-05.md)

`TODO fix link then remove this line`

## 文章

- [Microarchitecture cheat sheet ](https://github.com/akhin/microarchitecture-cheatsheet)

给你一个整体的视角，从流水线到cache到虚拟内存 。看图可以[点这个](https://raw.githubusercontent.com/akhin/microarchitecture-cheatsheet/main/microarchitecture-cheatsheet.svg)

- [Thoughts on -Wctad-maybe-unsupported](https://quuxplusone.github.io/blog/2022/10/07/wctad-maybe-unsupported/)

之前也聊过，CTAD可能有害，所以要加上告警规避这种场景，但是简单的告警还有可能漏掉某些场景，建议直接`-Werror=ctad`

- [A “pick two” triangle for std::vector](https://quuxplusone.github.io/blog/2022/09/30/vector-pessimization-pick-two/)

vector在move场景是比较保守的，如果T本身不是noexcept move，就copy。本身也是怕T本身move的副作用引发失败，退而求其次保守copy

考虑一个T实现

```cpp
struct Widget {
    std::list<int> m_ = std::list<int>(1000);
        // MSVC's std::list isn't nothrow movable
};

std::vector<Widget> v(10);
try {
    v.reserve(v.capacity()+1);  // reallocate the buffer
} catch (...) {
    // is v still in its old state?
}
```
正常的场景，不在乎copy的代价，只要保证Widget没问题就行，强异常处理bad alloc。这样能用没啥问题

如果强异常场景，还要尽可能的move，m_的move可能会有问题，那只好给Widget一个noexcept的move

```cpp
struct Widget {
    std::list<int> m_ = std::list<int>(1000);
        // MSVC's std::list isn't nothrow movable

    explicit Widget() = default;
    Widget(Widget&&) noexcept = default;  // !!
    Widget(const Widget&) = default;
    Widget& operator=(Widget&&) = default;
    Widget& operator=(const Widget&) = default;
};

std::vector<Widget> v(10);
```

又想尽可能的move，又想处理bad alloc，其他异常无所谓，做不到，只能自己造一个std::vector了

这个就是作者讨论的类似CAP的那种三角问题

说实话我没怎么理解明白

- [Prefer core-language features over library facilities](https://quuxplusone.github.io/blog/2022/10/16/prefer-core-over-library/)

使用核心内建的功能，而不是库提供的功能

比如 alignof 好过 std::alignment_of_v

```cpp
static_assert(std::alignment_of_v<Widget> == 8);  // worse
static_assert(alignof(Widget) == 8);  // better
```

比如alignas好过 std::aligned_storage_t

```cpp
std::aligned_storage<sizeof(Widget)> data;  // utterly wrong
std::aligned_storage_t<sizeof(Widget)> data;  // still kind of wrong
std::aligned_storage_t<sizeof(Widget), alignof(Widget)> data;  // correct but bad
alignas(Widget) char data[sizeof(Widget)];  // correct and better
```
比如char好过std::bytes

```cpp
std::byte data[100];  // worse
char data[100];  // better

int data[10];

// worse
void mycopy(std::byte *dst, const std::byte *src, size_t n);
mycopy((std::byte*)data, (std::byte*)(data+5), 5 * sizeof(int));

// better
void mycopy(void *dst, const void *src, size_t n);
mycopy(data, data+5, 5 * sizeof(int));
```
lambda 好过bind

range for好过std::for_each

不列代码了

struct好过tuple有名字信息

placement new 好过construct_at

```cpp
alignas(Widget) char data[sizeof(Widget)];

Widget *pw = std::construct_at((Widget*)data, x, y);  // worse
Widget *pw = ::new ((void*)data) Widget(x, y);  // better
```

当然这些都是习惯。不强求


- [Did you know that C++23 added support for constexpr std::bitset?](https://github.com/QuantlabFinancial/cpp_tip_of_the_week/blob/master/tips/300.md)


```cpp
#include <bitset>
 
constexpr std::bitset<4> b1{"0011"};
static_assert(0b0011 == b1.to_ulong());

constexpr std::bitset<4> b2{0b0011};
static_assert(b1 == b2);
```

这玩意谁用啊。folly有个省空间的bitset
## 视频

- [C++ Weekly - Ep 346 - C++23's bind_back ](https://www.youtube.com/watch?v=pDiP2frdMnI)

直接看代码吧 https://compiler-explorer.com/z/ee8MGrrEY 

bind的一种强化

## 开源项目需要人手

- [asteria](https://github.com/lhmouse/asteria) 一个脚本语言，可嵌入，长期找人，希望胖友们帮帮忙，也可以加群384042845和作者对线
- [pika](https://github.com/OpenAtomFoundation/pika) 一个nosql 存储， redis over rocksdb，非常需要人贡献代码胖友们， 感兴趣的欢迎加群294254078前来对线

## 新项目介绍/版本更新


---

看到这里或许你有建议或者疑问或者指出错误，请留言评论! 多谢!  你的评论非常重要！也可以帮忙点赞收藏转发！多谢支持！

[本文永久链接](https://wanghenshui.github.io/cppweeklynews/posts/085.html)
