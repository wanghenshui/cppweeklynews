---
layout: post
title:  第142期
---
# C++ 中文周刊 第142期


[周刊项目地址](https://github.com/wanghenshui/cppweeklynews)

公众号

<img src="https://wanghenshui.github.io/cppweeklynews/assets/code.png" alt=""  width="30%">

qq群 [手机qq点击进入](https://qm.qq.com/q/6NGizNPyG4)

RSS https://github.com/wanghenshui/cppweeklynews/releases.atom

欢迎投稿，推荐或自荐文章/软件/资源等

请[提交 issue](https://github.com/wanghenshui/cppweeklynews/issues)


最近在找工作准备面试题，更新可能有些拖沓，见谅

本周内容比较少

本期文章由 黄亮Anthony 赞助

---


## 资讯

标准委员会动态/ide/编译器信息放在这里

clion新增AI助手 https://www.jetbrains.com/clion/whatsnew/

编译器信息最新动态推荐关注hellogcc公众号 [OSDT Weekly 2023-12-06 第231期 ](https://mp.weixin.qq.com/s/_ssQHR97PSUuwxsaFS8dsg)


## 文章

- [In C++, how can I make a member function default parameter depend on this?](https://devblogs.microsoft.com/oldnewthing/20231206-00/?p=109108)

成员函数参数不能直接用this

```c++
struct Sample
{
    int increment;
    void add(int v = increment); // not allowed
    void notify_all(Sample* source = this); // not allowed
};
```

猥琐绕过

```c++
struct Sample
{
    int increment;

    void add(int v);
    void add() { add(increment); }

    void notify_all(Sample* source);
    void notify_all() { notify_all(this); }
};

Sample s;

s.add(2); // adds 2
s.add(); // adds s.increment

s.notify_all(); // uses source = s
s.notify_all(other); // uses source = other
```

- [Higher quality random floats](https://www.corsix.org/content/higher-quality-random-floats)

随机浮点数

常规

```c++
double pcg64_random_double(pcg64_t *rng) {
    return (double)(pcg64_random(rng) >> 11) * 0x1.0p-53;
}
```

但luajit是这样的

```c++
uint64_t lj_prng_u64d(PRNGState *rs) {
    uint64_t z, r = 0;
    TW223_STEP(rs, z, r)
    /* Returns a double bit pattern in the range 1.0 <= d < 2.0. */
    return (r & 0x000fffffffffffffull) | 0x3ff0000000000000ull;
}
/* Then to give d in [0, 1) range: */
U64double u;
double d;
u.u64 = lj_prng_u64d(rs);
d = u.d - 1.0;
```

lemire博士的golang版本

```go
// toFloat64 -> [0,1)
func toFloat64(seed *uint64) float64 {
    x := splitmix64(seed)
    x &= 0x1fffffffffffff // %2**53
    return float64(x) / float64(0x1fffffffffffff)
}
```

原理是这个 https://www.zhihu.com/question/25037345/answer/29879012

考虑浮点数的格式


## 视频

cppcon2023 工作日开始更新视频了，这周好玩的列一下



## 有意思的项目

- https://github.com/sunxfancy/vscode-llvm 在vscode里拿到llvm compiler explore类似的效果。检查IR，查看CFG之类的，很厉害 
- [asteria](https://github.com/lhmouse/asteria) 一个脚本语言，可嵌入，长期找人，希望胖友们帮帮忙，也可以加群753302367和作者对线 （原来的群被举报了）
- [Unilang](https://github.com/linuxdeepin/unilang) deepin的一个通用编程语言，点子有点意思，也缺人，感兴趣的可以github讨论区或者deepin论坛看一看。这里也挂着长期推荐了
- https://gitee.com/okstar-org/ok-edu-desktop 一个IM通信软件，做IM的可以关注，现在正在做全面整合阶段，开始组建商业团队阶段，年底开始融资，你参加了就快发财了，会的快来



## 互动环节

上一期提到的有问题的代码

```c++

int median(std::vector<int>& v) {
   int mid = v.size() / 2;
   std::nth_element(v.begin(), v.begin() + mid, v.end());
   int result = v[mid];
   if (v.size() % 2 == 0) {
     std::nth_element(v.begin(), v.begin() + mid - 1, v.end());
     result = (v[mid] + v[mid-1])/2;  
     // result = (result + v[mid-1]) /2;
   }
   return result;
}

```

周星星指出，完全可以第二个std::nth_element改成 std::max_element(begin,begin+mid)

确实是一个思路，或者更极端一点，偶数也不特殊处理就好了

huring指出这个问题在macbook m1上不复现我的提供的 10，10，29，18，10，10，10，10，13，32无法复现

只能说和平台也有点关系，巧合而已


突击提问：如何实现nth_element？最近面试刚被问到，我没上来优化的部分。已经自罚十个深蹲了

