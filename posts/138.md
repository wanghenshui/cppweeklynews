---
layout: post
title:  ç¬¬138æœŸ
---
# C++ ä¸­æ–‡å‘¨åˆŠ ç¬¬138æœŸ


[å‘¨åˆŠé¡¹ç›®åœ°å€](https://github.com/wanghenshui/cppweeklynews)

å…¬ä¼—å·

<img src="https://wanghenshui.github.io/cppweeklynews/assets/code.png" alt=""  width="30%">

qqç¾¤ [æ‰‹æœºqqç‚¹å‡»è¿›å…¥](https://qm.qq.com/q/6NGizNPyG4)

RSS https://github.com/wanghenshui/cppweeklynews/releases.atom

æ¬¢è¿æŠ•ç¨¿ï¼Œæ¨èæˆ–è‡ªèæ–‡ç« /è½¯ä»¶/èµ„æºç­‰

è¯·[æäº¤ issue](https://github.com/wanghenshui/cppweeklynews/issues)


æœ€è¿‘åœ¨æ‰¾å·¥ä½œå‡†å¤‡é¢è¯•é¢˜ï¼Œæ›´æ–°å¯èƒ½æœ‰äº›æ‹–æ²“ï¼Œè§è°…


æœ¬æœŸæ–‡ç« ç”± ä¸è¯­ é»„äº® èµåŠ©

---


## èµ„è®¯

æ ‡å‡†å§”å‘˜ä¼šåŠ¨æ€/ide/ç¼–è¯‘å™¨ä¿¡æ¯æ”¾åœ¨è¿™é‡Œ

c++26è¿›å±•å¦‚ç«å¦‚è¼ åå°„åˆåˆåˆåˆåˆä¸€æ¬¡è¢«ç«¯äº†å‡ºæ¥ï¼Œç»™äº†ä¸€å †ç¬¦å·è¯­æ³•ï¼Œæˆ‘è¯´å©·å©·å§ï¼Œæ„Ÿè§‰å¤Ÿå‘›

æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹è¿™ä¸ª [C++26é™æ€åå°„ææ¡ˆè§£æ](https://zhuanlan.zhihu.com/p/661692275)

æˆ‘è§‰å¾—æˆ‘ä¸æ˜¯ç¬¬ä¸€ä¸ªè®¨åŒè¿™ä¸ªè¯­æ³•çš„äºº

boost 1.84é¢„è§ˆç‰ˆå‡ºç‚‰ https://www.boost.org/users/history/version_1_84_0.html

æ–°åŠ å…¥cobaltåç¨‹ç»„ä»¶å’Œrediså®¢æˆ·ç«¯ä¸¤ä¸ªåº“ï¼Œéƒ½æ˜¯å †åœ¨asioä¸Šé¢çš„ã€‚å¯ä»¥å·å­¦ä¸€ä¸‹ï¼Œå·æ­»åŒè¡Œ

ä»€ä¹ˆï¼ä½ è¯´asioä½ éƒ½æ²¡ç ”ç©¶è¿‡ï¼Œç®—äº†è¿˜æ˜¯åˆ«ç ”ç©¶äº†ï¼Œå‘¨æœ«åº”è¯¥ä¼‘æ¯ï¼Œçœ‹ä¸€ä¹å°±è¡Œäº†

ç¼–è¯‘å™¨ä¿¡æ¯æœ€æ–°åŠ¨æ€æ¨èå…³æ³¨hellogccå…¬ä¼—å· [OSDT Weekly 2023-11-15 ç¬¬228æœŸ ](https://mp.weixin.qq.com/s/4hU89AP-EDfHii5je3Fz_A)
    
## æ–‡ç« 

- [Coroutine é‡æ„æ•°æ®åº“ç®—å­â€”â€”ä»¥ hash join probe ä¸ºä¾‹](https://zhuanlan.zhihu.com/p/666465496)

è¿™ä¸ªæ˜¯æˆ‘ç¬¬ä¸€æ¬¡è§åˆ°è®¡ç®—å±‚å¼•å…¥åç¨‹çš„å®è·µï¼Œä¹‹å‰æœ‰ä¸ªcorobaseè®ºæ–‡ï¼Œå¦å¤–åƒscylladdb redpandaæ›´å¤šæ˜¯æŠŠåç¨‹æ”¾åœ¨ç®€å•ä»»åŠ¡é€»è¾‘ä»¥åŠæ–‡ä»¶å¤„ç†ä¸Š

è¿™ä¸ªè¿˜æ˜¯æŒºç²¾å½©çš„

- [Why does calling a coroutine allocate a lot of stack space even though the coroutine frame is on the heap?](https://devblogs.microsoft.com/oldnewthing/20231115-00/?p=109020)

ä¸ºå•¥coroutineéœ€è¦é¢å¤–çš„æ ˆç©ºé—´ï¼Ÿåç¨‹æ ˆä¸åº”è¯¥åœ¨heapä¸Šå—ï¼Ÿ

æ¯”å¦‚è¿™å¨ä»£ç 

```c++
#include <coroutine>
#include <exception>

// Define a coroutine type called "task"
// (not relevant to scenario but we need *something*.)
struct task { void* p; };

namespace std
{
    template<typename...Args>
    struct coroutine_traits<task, Args...>
    {
        struct promise_type
        {
            task get_return_object() { return { this }; }
            void unhandled_exception() { std::terminate(); }
            void return_void() {}
            suspend_never initial_suspend() { return {}; }
            suspend_never final_suspend() noexcept { return {}; }
        };
    };
}
// End of "task" boilerplate.

void consume(void*);

task sample()
{
    char large[65536];
    consume(large);
    co_return;
}
```

å› ä¸ºè¿™ä¸ªcoroutineå¹¶ä¸ä¼šsuspendï¼Œèƒ½èµ°heap allocation elisionä¼˜åŒ–HALO

å¯èƒ½è¿™ç§åœºæ™¯ä½ å¯èƒ½å¾—å…³æ³¨æ ˆæº¢å‡ºé—®é¢˜ï¼Œå¦‚æœä½ æ˜¯msvcç”¨æˆ·ï¼Œæ­å–œä½ ï¼Œmsvcæœ‰bugï¼Œæ²¡åšä¼˜åŒ–ï¼Œè¿˜æ˜¯åœ¨å †heapä¸Š

ä¸ºä»€ä¹ˆæ²¡åšä¼˜åŒ–ï¼Ÿåšäº†ï¼Œä½†æ˜¯æ²¡å®Œå…¨ç”Ÿæ•ˆï¼Œä»£ç é‡Œå†™äº†ç”Ÿæˆ __coro_elision_buffer 

ä½†æ²¡åˆ¤æ–­å‡º__coro_elision_buffer å®Œå…¨æ²¡ç”¨æ²¡å½»åº•ä¼˜åŒ–æ‰ã€‚[å·²ç»åœ¨ä¿®äº†](https://developercommunity.visualstudio.com/t/Coroutine-reserves-stack-space-for-heap/10270583) 

å½“ç„¶è¿™ç§ä¼˜åŒ–æ˜¯å¥½çš„ï¼Œåªæ˜¯æé†’ä½ æ³¨æ„ä½ çš„åç¨‹å±€éƒ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè€Œå·²ï¼Œä½ è¦æ˜¯å®³æ€•ï¼Œè¿™ä¹ˆç©ä¹Ÿä¸æ˜¯ä¸è¡Œ

```c++
task sample()
{
    auto large = std::make_unique_for_overwrite<char[]>(65536);
    consume(large.get());
    co_return;
}
```

- [è«éæˆ‘é‡åˆ°äº†ä¼ è¯´ä¸­çš„bug](https://zhuanlan.zhihu.com/p/665981703)

å¾ˆç²¾å½©çš„bitåè½¬ï¼Œå®¢æˆ·ç«¯ç¡®å®å°‘è§

- [æ·±å…¥æµ…å‡º LLVMä¹‹ Value ã€User ã€Use æºç è§£æ](https://zhuanlan.zhihu.com/p/666016704)
- [LLVMæºç é˜…è¯»ä¹‹ BasicBlock éå†](https://zhuanlan.zhihu.com/p/664407911)

äº†è§£llvmçš„ï¼Œçœ‹ä¸€ä¹, ä½œè€…è¿˜æ˜¯å­¦ç”Ÿï¼ŒæŒºå‰å®³çš„

- [C++ Pitfall : shared_future](https://sheep.horse/2023/11/c++_pitfall_-_shared_future.html)

shared_future::getæœ‰å¤åˆ¶ï¼Œæ³¨æ„Tçš„å¤åˆ¶æ˜¯å¦è¿‡é‡

ä½œè€…å»ºè®®å¹²è„†åˆ«ç”¨

- [æ·±å…¥ç†è§£åŸºäº eBPF çš„ C/C++ å†…å­˜æ³„æ¼åˆ†æ](https://zhuanlan.zhihu.com/p/665778795)

å…¶å®å°±æ˜¯memcheck

- [std::source_location is Broken](https://www.elbeno.com/blog/?p=1738)

std::source_locationæœ¬åº”è¯¥æ˜¯ç¼–è¯‘æœŸå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å´åªæä¾›ä¸€ä¸ªconst char *

è„‘ç˜«æ¥å£

- [C++23 Characters](https://euroquis.nl//blabla/2023/11/16/cpp.html)


```c++
QString getSheep() {
  return QStringLiteral("ğŸ‘");
}
```

è¿™ä¸ªğŸæ€ä¹ˆæ‰“å‘¢

```c++
QString getSheep() {
  return QStringLiteral("\N{SHEEP}");
}
```

ç›®å‰è¿™ç§ç”¨æ³•ä¹Ÿå°±clang15æ”¯æŒ

- [Why Do Peephole Optimizations Work?](https://blog.regehr.org/archives/2485)

é¦–å…ˆè¦çŸ¥é“peepholeä¼˜åŒ–æ˜¯å•¥ï¼Œ

ç®€å•è¯´å°±æ˜¯å°æ±‡ç¼–ä»£ç æ®µé‡å†™ï¼Œåˆ é™¤ï¼Œä»£æ•°ä¼˜åŒ–ï¼Œé™ä½å¯„å­˜å™¨å¤ç”¨æé«˜åå ç®€åŒ–æ§åˆ¶æµ æŒ‡ä»¤åˆä¸€



- [Generating arrays at compile-time in C++ with lambdas](https://lemire.me/blog/2023/11/07/generating-arrays-at-compile-time-in-c-with-lambdas/)

è€ƒè™‘ä¸€ä¸ªæ‰“è¡¨

```c++
constexpr static bool is_forbidden_host_code_point_table[] = {
  1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
bool is_forbidden_host_code_point(char c) {
  return is_forbidden_host_code_point_table[uint8_t(c)];
}
```


ä¸€ä¸ªä¸€ä¸ªæ•²ï¼Œçœ¼ç›éƒ½èŠ±äº†ã€‚æ€ä¹ˆç”Ÿæˆï¼Ÿæ„Ÿè°¢constexpr

```c++
constexpr static std::array<uint8_t, 256> is_forbidden_array = []() {
  std::array<uint8_t, 256> result{};
  for (uint8_t c : {'\0', '\x09', '\x0a','\x0d', ' ', '#', '/', ':',
    '<', '>', '?', '@', '[', '\\', ']', '^', '|'}) {
   result[c] = true;
  }
  return result;
}();

bool is_forbidden_host_code_point_array(char c) {
  return is_forbidden_array[uint8_t(c)];
}
```

ç¼–è¯‘å™¨å¸®æˆ‘æ‰“è¡¨ã€‚å¿«è¯´è°¢è°¢constexpr

- [â€œMemsetâ€ in O1](https://www.dyx.name/notes/memset-o1.html)

åŠ ä¸ªflagæ ‡è®°åˆå§‹åŒ–è¿‡äº†

å¥½å¥½å¥½ä½ è¿™ä¹ˆæ•´æ˜¯å§

## å¼€æºé¡¹ç›®ä»‹ç»

- [asteria](https://github.com/lhmouse/asteria) ä¸€ä¸ªè„šæœ¬è¯­è¨€ï¼Œå¯åµŒå…¥ï¼Œé•¿æœŸæ‰¾äººï¼Œå¸Œæœ›èƒ–å‹ä»¬å¸®å¸®å¿™ï¼Œä¹Ÿå¯ä»¥åŠ ç¾¤384042845å’Œä½œè€…å¯¹çº¿

æœ€è¿‘è¿›å±•ï¼Œä¼˜åŒ–JIT/åŸºç¡€ç»„ä»¶è°ƒä¼˜ï¼Œå¯¹äºåšè¯­è¨€çš„è¿˜æ˜¯èƒ½è§è¯†åˆ°ä¸€ç‚¹ä¸œè¥¿çš„

- [Unilang](https://github.com/linuxdeepin/unilang) deepinçš„ä¸€ä¸ªé€šç”¨ç¼–ç¨‹è¯­è¨€ï¼Œç‚¹å­æœ‰ç‚¹æ„æ€ï¼Œä¹Ÿç¼ºäººï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥githubè®¨è®ºåŒºæˆ–è€…deepinè®ºå›çœ‹ä¸€çœ‹ã€‚è¿™é‡Œä¹ŸæŒ‚ç€é•¿æœŸæ¨èäº†
- [gcc-mcf](https://gcc-mcf.lhmouse.com/) æ‡‚çš„éƒ½æ‡‚
- https://github.com/hggq/paozhu ä¸€ä¸ªç½‘ç»œæ¡†æ¶
- https://gitee.com/okstar-org/ok-edu-desktop ä¸€ä¸ªIMé€šä¿¡è½¯ä»¶ï¼ŒåšIMçš„å¯ä»¥å…³æ³¨ï¼Œç°åœ¨æ­£åœ¨åšå…¨é¢æ•´åˆé˜¶æ®µï¼Œå¼€å§‹ç»„å»ºå•†ä¸šå›¢é˜Ÿé˜¶æ®µï¼Œå¹´åº•å¼€å§‹èèµ„ï¼Œä½ å‚åŠ äº†å°±å¿«å‘è´¢äº†ï¼Œä¼šçš„å¿«æ¥
- https://github.com/volt-software/Ichor/tree/v0.3.0 ä¸€ä¸ªc++20 æœåŠ¡æ¡†æ¶

æœ‰ä¸ªå“¥ä»¬ç»™gccåŠ ä¸Šäº†ç‰¹æ®Šçš„ç¿»è¯‘ https://github.com/Mosklia/gcc-hentai

é¢„è§ˆæ•ˆæœ å–œå‰§æ•ˆæœæ¯”è¾ƒå¼º 

![](https://user-images.githubusercontent.com/8872493/282465333-8a2073bf-565a-4051-b6e6-0f805e5cb3ed.jpg)

## è§†é¢‘

- `*(char*)0 = 0;` - What Does the C++ Programmer Intend With This Code? - JF Bastien - C++ on Sea 2023 https://www.youtube.com/watch?v=dFIqNZ8VbRY

è¿™å“¥ä»¬éå¸¸å¤¸å¼ 

å…¶å®è¿™ä¸ªåœ¨åµŒå…¥å¼æ¯”è¾ƒå¸¸è§ï¼Œå°±æ˜¯ç»™å†…å­˜0çš„åœ°æ–¹æ¸…é›¶

ç”±äºä¼—æ‰€å‘¨çŸ¥çš„é—®é¢˜ï¼Œnullptrçš„å€¼æ˜¯0ï¼Œlinux windowsè®¿é—®0åœ°å€ç›´æ¥å´©æºƒï¼Œæ¯•ç«ŸUB

ä½ ä¸ºå•¥è¿™ä¹ˆå†™ï¼Ÿä½œè€…è®²è¿™ä¸ªä¸ºä»€ä¹ˆè®²äº†ä¸€ä¸ªå°æ—¶æˆ‘é 

ç²¾å½©æ˜¯ç²¾å½©ï¼Œæœ‰ç‚¹é•¿äº†ï¼Œå–œæ¬¢è„±å£ç§€çš„å¯ä»¥çœ‹çœ‹


## äº’åŠ¨ç¯èŠ‚

æœ€è¿‘çœ‹åˆ°ä¿©bug

ä¸€ä¸ªæ˜¯å­˜å‚¨å¼•æ“ å­—ç¬¦ä¸²æ¯”è¾ƒç”¨strcmp

ä¸€ä¸ªæ˜¯ç¼–è§£ç  string.substr(0,0)

å¦å¤–åœ¨çŸ¥ä¹çœ‹åˆ°çš„ https://www.zhihu.com/question/630025869

```c++
std::vector<int> vec{10,2,2,10};
auto max_iter = std::max_element(vec.begin(), vec.end());
vec.erase(std::remove(vec.begin(), vec.end(), *max_iter), vec.end());
// vecä¸­çš„å…ƒç´ å˜æˆäº†{2,10}
```

è¿™ä¸ªæ˜¯ç»å…¸aliasè¯­ä¹‰é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸ºå•¥å¤§å®¶å®ç°decay_copyçš„æºå¤´ï¼Œè¿˜æ˜¯æœ‰äººèƒ½é‡åˆ°

è¯»è€…ä»¬æœ‰æ²¡æœ‰å¥½ç©çš„bugï¼Œæ¬¢è¿è¯„è®ºåŒºåé¦ˆ

è¯è¯´æˆ‘ä¹Ÿå†™è¿‡ä¸åŒåŸºç±»è™šå‡½æ•°åŒåå­—å¯¼è‡´æŸ¥æ‰¾è«åå…¶å¦™åŒ¹é…çš„bugï¼Œå“ˆå“ˆã€‚äº’å‘