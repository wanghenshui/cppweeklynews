---
layout: post
title:  第119期
---
# C++ 中文周刊 第119期


[周刊项目地址](https://github.com/wanghenshui/cppweeklynews)

公众号

<img src="https://wanghenshui.github.io/cppweeklynews/assets/code.png" alt=""  width="30%">



RSS https://github.com/wanghenshui/cppweeklynews/releases.atom

欢迎投稿，推荐或自荐文章/软件/资源等

请[提交 issue](https://github.com/wanghenshui/cppweeklynews/issues)

c++26进行中，一堆trip report

---

## 资讯

标准委员会动态/ide/编译器信息放在这里

[编译器信息最新动态推荐关注hellogcc公众号 本周更新 2023-01-04 第183期](https://github.com/hellogcc/osdt-weekly/blob/master/weekly-2023/2023-01-04.md)

`TODO fix link then remove this line`

## 文章

- [GCC 14 NRVO enhancements](https://www.reddit.com/r/cpp/comments/145fnjl/gcc_14_nrvo_enhancements/)

gcc14引入 -Wnrvo 帮助提醒优化返回值，[P2025](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p2025r2)

代码patch在这里 

https://gcc.gnu.org/git/?p=gcc.git;a=commit;h=7e0b65b239c3a0d68ce94896b236b03de666ffd6

https://gcc.gnu.org/git/?p=gcc.git;a=commit;h=28db36e2cfca1b7106adc8d371600fa3a325c4e2

这方面不如clang，话说clang早就上了

- [New C++ features in GCC 13](https://developers.redhat.com/articles/2023/06/21/new-c-features-gcc-13#)

默认-std=gnu++17，带来一堆23的功能

放松static_assert
```cpp
template<typename> void f() {
  static_assert (false, "");
}
```

没特化之前这里不报错，还是很有用的

放松 constexpr限制

```cpp
constexpr char test () {
  static constexpr char c[] = "Hello World"; // OK in C++23
  return c[1];
}

static_assert (test () == 'e');
```

支持static operator

比如()
```cpp
struct S {
  static constexpr bool operator() (int x, int y) { return x < y; }
};
constexpr S s;
static_assert (s (1, 2));

void g() {
  S::operator()(1, 2);  // OK in C++23
}
```

比如[]

```cpp
struct S {
  S() {}
  static int& operator[]() { return mem[0]; }
  static int mem[64];
};

void g() {
  S s;
  s[]++;
}
```

浮点数增强
```c++
#include <stdfloat>

int main (){
  std::float16_t f16 = 1.0f16;
  std::float32_t f32 = 2.0f32;
  std::float64_t f64 = 3.0f64;
  std::float128_t f128 = 4.0f128;
 std::bfloat16_t x = 1.0bf16;
}
```

move简化, 这种代码gcc13编译不过了
```cpp
int& g(int&& x) {
  return x; 
}
```

assume终于来了，contraits的一小部分能力

```cpp
int foo (int x, int y) {
  [[assume (x >= y)]];
  if (x == y)
    return 0;
  else if (x > y)
    return 1;
  else
    return -1;
}
```

生成的汇编更简单

```asm
@@ -8,11 +8,7 @@ _Z3fooii:
.cfi_startproc
xorl    %eax, %eax
cmpl    %esi, %edi
-    je    .L1
-    setg    %al
-    movzbl    %al, %eax
-    leal    -1(%rax,%rax), %eax
-.L1:
+    setne    %al
ret
.cfi_endproc
 .LFE0:
```
- [C++20 Coroutines Driving a Job System](https://poniesandlight.co.uk/reflect/coroutines_job_system/)

- [folly中异步框架future与DAG](https://www.yinkuiwang.cn/2023/01/08/folly%E5%BC%82%E6%AD%A5%E6%A1%86%E6%9E%B6%E4%B8%8EDAG/)

- [Trip report: Summer ISO C++ standards meeting (Varna, Bulgaria)](https://herbsutter.com/2023/06/16/trip-report-summer-iso-c-standards-meeting-varna-bulgaria/)
- [Trip report: Summer ISO C++ Meeting in Varna, Bulgaria ](https://www.think-cell.com/en/career/devblog/trip-report-summer-iso-cpp-meeting-in-varna-bulgaria)
- [Why You Should Only Rarely Use std::move](https://accu.org/journals/overload/31/175/fertig/)

大意是别move返回值优化的编译器能处理好的场景

- [Type Safe C++ enum Extensions](https://accu.org/journals/overload/31/175/steinbach/)

```cpp
  enum class Suit{
  spades, hearts, diamonds, clubs };

  enum class Suit_with_joker extends Suit {
    joker };
```

想要这种语法，又能复用，又能安全，然后他用类继承糊了一个

```c++
struct Suit;
struct Suit_names
{
  static const Suit spades;
  static const Suit hearts;
};
struct Suit:
  Suit_names
{
  int value;
  constexpr explicit Suit( const int v )
    : value( v ) {}
};
constexpr Suit Suit_names::spades = Suit( 0 );
constexpr Suit Suit_names::hearts = Suit( 1 );

struct Suit_with_joker;
struct Suit_with_joker_names:
  Suit_names
{
  static const Suit_with_joker joker;
};
struct Suit_with_joker:
  Suit_with_joker_names
{
  int value;
  constexpr explicit
    Suit_with_joker( const int v ): value( v ) {}
  constexpr Suit_with_joker( const Suit v )
    : value( v.value ) {}
};
constexpr Suit_with_joker
  Suit_with_joker_names::joker
  = Suit_with_joker( 4 );
auto main() -> int
{
  (void) Suit_with_joker::hearts;
    // OK, has inherited the "enumerators".
  Suit_with_joker s1 = Suit::hearts;
    // OK, right way is-a relationship.
  #ifdef FAIL_PLEASE
    Suit s2 = Suit_with_joker::joker;
      //! C. error, /as it should be/. :)
  #endif
}
```

这种需求真的有么？不太值得

- [Optimizing the `pext` perfect hash function](https://xoranth.net/verb-parse/)

看不懂
 



- [Five Awesome C++ Papers for the H1 2023 - C++26, Varna and More](https://www.cppstories.com/2023/h1-cpp-papers23/)
## 视频


Last week the ACCU Conference YouTube Channel released the following C++ videos:

    Standard Attributes in C and C++ - [Rerelease] - Timur Doumler - https://youtu.be/TDKqAWtvH9c

    Test-Driven Development of C++ Embedded and System-Level Software - Vladimir Vishnevskii - https://youtu.be/PYc2KuFce7o

    Improving C++ Compilation Times: Tools & Techniques - Vittorio Romeo - https://youtu.be/PfHD3BsVsAM

    Breaking Enigma With the Power of Modern C++ - Mathieu Ropert - https://youtu.be/ef78lSbgHNk

- [C++ Weekly - Ep 381 - C++23's basic_string::resize_and_overwrite](https://www.youtube.com/watch?v=Ymm0yN_QUQA&ab_channel=C%2B%2BWeeklyWithJasonTurner)

能用就用，这玩意不如resize_uninit, 也不知道为啥非得整个lambda接口，服了


- [itCppCon23 Lock-free Micro Problems (Davide Di Gennaro)](https://www.youtube.com/watch?v=N-3Hxgan1KA&ab_channel=ItalianCppCommunity)
## 开源项目需要人手

- [asteria](https://github.com/lhmouse/asteria) 一个脚本语言，可嵌入，长期找人，希望胖友们帮帮忙，也可以加群384042845和作者对线
- [Unilang](https://github.com/linuxdeepin/unilang) deepin的一个通用编程语言，点子有点意思，也缺人，感兴趣的可以github讨论区或者deepin论坛看一看。这里也挂着长期推荐了
- [gcc-mcf](https://gcc-mcf.lhmouse.com/) 懂的都懂


## 新项目介绍/版本更新
- https://github.com/Ericsson/codechecker/ 整合了clang analyser和clang-tidy
- https://github.com/orlp/polymur-hash 有点噱头啊，没有wyhash快，说什么碰撞率可预测啥啥数学证明这那的
## 工作招聘

---



[本文永久链接](https://wanghenshui.github.io/cppweeklynews/posts/119.html)

如果有疑问评论最好在上面链接到评论区里评论，这样方便搜索，微信公众号有点封闭/知乎吞评论
