---
layout: post
title:  第111期
---
# C++ 中文周刊 第111期


[周刊项目地址](https://github.com/wanghenshui/cppweeklynews)

公众号

<img src="https://wanghenshui.github.io/cppweeklynews/assets/code.png" alt=""  width="30%">

弄了个qq频道，[手机qq点击进入](https://qun.qq.com/qqweb/qunpro/share?_wv=3&_wwv=128&inviteCode=xzjHQ&from=246610&biz=ka)

RSS https://github.com/wanghenshui/cppweeklynews/releases.atom

欢迎投稿，推荐或自荐文章/软件/资源等

请[提交 issue](https://github.com/wanghenshui/cppweeklynews/issues)

总算放假了

---

## 资讯

标准委员会动态/ide/编译器信息放在这里

[编译器信息最新动态推荐关注hellogcc公众号 本周更新 2023-01-04 第183期](https://github.com/hellogcc/osdt-weekly/blob/master/weekly-2023/2023-01-04.md)

`TODO fix link then remove this line`

## 文章

- [Did you know that C++17 added std::forward_as_tuple and std::make_from_tuple and what’s the difference between them](https://github.com/QuantlabFinancial/cpp_tip_of_the_week/blob/master/tips/327.md)

```cpp
int main() {
  struct foo {
    int i;
    bool b;
  };

  const int i = 42;
  const auto f = std::make_from_tuple<foo>(std::forward_as_tuple(i, true));
  std::cout << f.i << ' ' << f.b << '\n'; // prints 42 1
}
```

没啥说的

- [The obvious final step](https://akrzemi1.wordpress.com/2023/04/23/the-obvious-final-step/)

有时候写出这种代码就很烦

```c++
xml.begin_element("port");
xml.attribute("name", name);
xml.attribute("location", loc);
xml.end_element("port");  // <-- the obvious final step
```
还有就是事务那种

```cpp
DBTransaction trx{parameters};
trx.execute(sql1);
trx.execute(sql2);
trx.commit();  // <-- the obvious final step
```

其实很像lock 搞个scope_guard有点大材小用，之前也提到过，对于mutex把它和保护对象合成一个类，然后暴露个with接口，比如

```cpp
struct Thing {
    MutexProtected<Field> field;
};

thing->field.with([&](Field& field) {
    use(field);
});
```
按照这种思路，上面两段代码可以改成

```cpp
template <typename Callback>
void XML::with_element(std::string_view name, Callback userLogic)
{
  begin_element(name);
  userLogic();
  end_element(name);
}
 
// User code:
 
xml.with_element("port", [&] {
  xml.attribute("name", name);
  xml.attribute("location", loc);
});


db_transaction(parameters, [&]{
  trx.execute(sql1);
  trx.execute(sql2);
};
```

随着lambda的引入，感觉又不清晰了是不是，但是确实写的干净一些

- [Don’t Look UB: Exposing Sanitizer-Eliding Compiler Optimizations](https://goto.ucsd.edu/~gleissen/papers/dontlookub.pdf)

利用sanitizer来矫正优化，修改代码，概念有点意思

代码没开源 https://github.com/vusec/LookUB

- [The View of The String](https://cppsenioreas.wordpress.com/2023/04/24/the-view-of-the-string/)

老生常谈，string string_view一些使用问题

- [How to check if a pointer is in a range of memory](https://devblogs.microsoft.com/oldnewthing/20170927-00/?p=97095)

给你一个指针和一个范围
```cpp
byte* regionStart;
size_t regionSize;

if (p >= regionStart && p < regionStart + regionSize)
```

这样检查范围是对的吗？

不一定，看内存分配的设计，有些老系统设计可能会有一些荣誉，比如把32拆两半，前一半表示具体块，后一半表示offset，这种场景下最末端不一定等于regionstart+regioinSize，分布方式可能没那么简单

- [Why is std::hardware_destructive_interference_size a compile-time constant instead of a run-time value?](https://devblogs.microsoft.com/oldnewthing/20230424-00/?p=108085)

没啥说的，这个值是标准库为你准备的常见cacheline值，信不过就自已指定
## 视频

- [C++ Weekly ](https://www.youtube.com/channel/UCxHAlbZQNFU2LgEtiqd2Maw)

`TODO fix link then remove this line`

## 开源项目需要人手

- [asteria](https://github.com/lhmouse/asteria) 一个脚本语言，可嵌入，长期找人，希望胖友们帮帮忙，也可以加群384042845和作者对线
- [Unilang](https://github.com/linuxdeepin/unilang) deepin的一个通用编程语言，点子有点意思，也缺人，感兴趣的可以github讨论区或者deepin论坛看一看。这里也挂着长期推荐了
- [paozhu](https://github.com/hggq/paozhu) 国人开发的web库，和drogon联系过没共建而考虑自己的需求基于asio开发。感兴趣的可以体验一下，挂在这里长期推荐了

## 新项目介绍/版本更新

- [BppTree](https://github.com/jeffplaisance/BppTree)一个b树实现
## 工作招聘

---



[本文永久链接](https://wanghenshui.github.io/cppweeklynews/posts/111.html)

如果有疑问评论最好在上面链接到评论区里评论，这样方便搜索，微信公众号有点封闭/知乎吞评论
