---
layout: post
title:  第137期
---
# C++ 中文周刊 第137期


[周刊项目地址](https://github.com/wanghenshui/cppweeklynews)

公众号

<img src="https://wanghenshui.github.io/cppweeklynews/assets/code.png" alt=""  width="30%">

qq群 [手机qq点击进入](https://qm.qq.com/q/6NGizNPyG4)

RSS https://github.com/wanghenshui/cppweeklynews/releases.atom

欢迎投稿，推荐或自荐文章/软件/资源等

请[提交 issue](https://github.com/wanghenshui/cppweeklynews/issues)


最近在找工作准备面试题，更新可能有些拖沓，见谅


以后可能要改变一下内容

一周发文章总结，一周发视频总结，这样两种内容交叉一下

本期发文章

本期文章由 不语 陈青松 赞助

---

## 资讯

标准委员会动态/ide/编译器信息放在这里 十月邮件 https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/#mailing2023-10

编译器信息最新动态推荐关注hellogcc公众号 [OSDT Weekly 2023-10-25 第225期 ](https://mp.weixin.qq.com/s/pw-3tApqW-26cKuBGladyQ)


## 文章


- [Compile time string literals processing, but why?](https://a4z.gitlab.io/blog/2023/11/04/Compiletime-string-literals-processing.html)

介绍一些编译期字符串组件，source_location magic_enum之类的 不知道magic_num的看这里 https://github.com/Neargye/magic_enum

- [Generic Topological Sort](https://biowpn.github.io/bioweapon/2023/11/03/topological-sort.html)

拓扑排序。感觉这个可以出算法题了

首先要明白什么是拓扑排序,可能直观印象就是leetcode那些题

那么std::sort能不能用于拓扑排序？

- [The dangers of releasing the last strong reference from within its own callback](https://devblogs.microsoft.com/oldnewthing/20230927-00/?p=108831)

考虑类中注册回调函数，析构可能就要把注册的回调函数去掉，有一种可能，回调函数在调用的途中，类自己已经析构了，回调函数也unregister了

如何解决这种问题？

直观的解决办法就是析构的时候等待调用结束，其实就是引用计数，调用的时候+1 调用结束-1

这其实引入了shared_ptr循环依赖的的问题，导致永远不能析构，死锁

如何解决这种死锁问题？考虑引入weakptr？

考虑析构拆出来，弄个final_release静态方法？ https://learn.microsoft.com/zh-cn/windows/uwp/cpp-and-winrt-apis/details-about-destructors#deferred-destruction

或者把callback和类自身生命周期绑定在一起，结合weakptr 这种设计比较常见

```c++
class MyObject {
    MyObject()
    {
        m_widget.prime();
        // Do this last: Don't register for callbacks  
        // until all members are ready.                
        m_callback.register(&MyObject::callback, this);
    }

    ~MyObject()
    {
        // Do this first: Ensure all outstanding
        // callbacks have completed.            
        m_callback.reset();                     
        m_widget.disable();
    }
};
void MyObject::Callback(CallbackData* data, void* context)
{
    auto self = reinterpret_cast<MyObject*>(context);

    [](auto weak, auto important) -> fire_and_forget {
        co_await resume_background();
        if (auto strong = weak.get()) {
            ⟦ do stuff with "strong" ⟧
        }
    }(get_weak(), data->important);
}
```

#### [How to use std::span from C++20 ](https://www.cppstories.com/2023/span-cpp20/)

span相比string_view有个优点，就是可以改动

#### [Why does unsafe multithreaded use of an std::unordered_map crash more often than unsafe multithreaded use of a std::map?](https://devblogs.microsoft.com/oldnewthing/20231103-00/?p=108966)


客户的代码多线程裸奔，使用map来读写，崩溃次数还算少，就没怎么关注，某一天改成unordered_map 崩溃次数多了。只能加锁了

为什么？unordered_map冲突变更导致迭代器失效的概率比map这种有序的低

我觉得这种知识还是不要知道的好

## 开源项目需要人手

- [asteria](https://github.com/lhmouse/asteria) 一个脚本语言，可嵌入，长期找人，希望胖友们帮帮忙，也可以加群384042845和作者对线
- [Unilang](https://github.com/linuxdeepin/unilang) deepin的一个通用编程语言，点子有点意思，也缺人，感兴趣的可以github讨论区或者deepin论坛看一看。这里也挂着长期推荐了
- [gcc-mcf](https://gcc-mcf.lhmouse.com/) 懂的都懂
- https://github.com/hggq/paozhu 一个网络框架
- https://gitee.com/okstar-org/ok-edu-desktop 一个IM通信软件，做IM的可以关注，现在正在做全面整合阶段，开始组建商业团队阶段，年底开始融资，你参加了就快发财了，会的快来

